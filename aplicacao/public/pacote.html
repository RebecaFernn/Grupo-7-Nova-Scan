<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Dashboard - Perda de Pacote</title>
  <!-- LINK CSS -->
  <link rel="stylesheet" href="css/pacotes.css">
  <link rel="stylesheet" href="css/navBarDash.css">

  <!-- FONTES -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
    rel="stylesheet">
  <link
    href="https://fonts.googleapis.com/css2?family=Prompt:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="listarmaquinas()">
  <div class="paitodas">

    <div class="NavBar">
      <div class="topNavBar">
        NOVASCAN
      </div>
      <div class="midNavBar">
        <div class="links" onclick="overview()">
          <img src="./img/overview.svg" alt="">
          <a href="overview.html">Overview</a>
        </div>
        <div class="links" onclick="maquinas()">
          <img src="./img/selfchekout.svg" alt="">
          <a href="maquinas.html">Self-Checkouts</a>
        </div>
        <div class="links" onclick="colaboradores()">
          <img src="./img/colaboradores.svg" alt="">
          <a href="colaboradores.html">Colaboradores</a>
        </div>
        <div class="links" onclick="editarPerfil()">
          <img src="./img/editPerfil.svg" alt="">
          <a href="editar_perfil.html">Editar Perfil</a>
        </div>
        <div class="links" onclick="metricas()">
          <img src="./img/metricas.svg" alt="">
          <a href="#">Personalizar alertas</a>
        </div>
        <div class="links" onclick="picos()">
          <img src="./img/picos.svg" alt="">
          <a href="#">Monitoramento Uptime e Downtime</a>
        </div>
      </div>
      <div class="lowNavBar">
        <img src="./img/LogoBranca.svg" class="imgLow">
        <div class="links" onclick="index()">
          <img src="./img/sair.svg" alt="">
          <a href="#">Logout</a>
        </div>
      </div>
    </div>
    <div class="main">
      <h1>Horários de Perda de pacotes - semanal 11/11 - 15/11</h1>



      <div class="filtro">
        <select class="select-maquinas" id="select-maquinas">
          <option>Selecione a máquina</option>

        </select>
        <button onclick="buscarDados()">Buscar</button>
      </div>

      <div class="dashboard">
        <div class="chart">
          <h2></h2>
          <div>
            <canvas id="myChart-Bytes" width="400" height="150">Gráfico-Maquina</canvas>
          </div>
        </div>

        <div class="chart">
          <h2>Máquinas Cadastradas</h2>
          <div>
            <div class="maquinascadastradas" id="nomeMaquina"></div>
            <h1 id="enviado"></h1>
            <div class="valor" id="valorEnv"></div>
            <h1 id="recebido"></h1>
            <div class="valor" id="valorRec"></div>
          </div>
        </div>

        <div class="chart">
          <h2>Perda de Pacotes</h2>
          <div>
            <canvas id="myChart-Pacotes" width="400" height="150">Gráfico-Perda</canvas>
          </div>
        </div>
      </div>
    </div>

  </div>
</body>

</html>

<script src="js/href.js"></script>
<script>

  function listarmaquinas() {
    var fkEmpresa = sessionStorage.getItem('FK_EMPRESA')

    fetch(`/kaue/listamaquina/${fkEmpresa}`, {
      method: 'GET',
      headers: { "Content-Type": "application/json" },
    })
      .then(function (resposta) {
        return resposta.json()
      })
      .then(function (resultado) {
        console.log("Dados retornado do banco", resultado)

        var nomeMaquina = document.getElementById('nomeMaquina')
        var bytesEnviados = document.getElementById('enviado')
        var bytesRecebidos = document.getElementById('recebido')
        var valorEnv = document.getElementById('valorEnv')
        var valorRec = document.getElementById('valorRec')

        nomeMaquina.innerHTML = resultado[0].nome
        bytesEnviados.innerHTML = resultado[0].descricao
        bytesRecebidos.innerHTML = resultado[1].descricao
        valorEnv.innerHTML = resultado[0].valor
        valorRec.innerHTML = resultado[1].valor
        
        for(i = 0; i < resultado.length; i++ ) {
          var listMaquina = document.getElementById('select-maquinas')
          listMaquina.innerHTML += `<option value="${resultado[i].nome}">${resultado[i].nome}</option>` 
        }   


      })
      .catch(function(error){
        console.log("nenhum dado foi encontrado", error)
      })
  }
  function buscarDados(){
    var selectElement = document.getElementById('select-maquinas');
    var maquinaSelecionada = selectElement.value;

    if(!maquinaSelecionada || maquinaSelecionada == 'Selecione a máquina'){
      alert("Por favor, selecione uma máquina válida.");
      return;
    }
    console.log('Valor de maquinaSelecionada:', maquinaSelecionada);

    Promise.all([
    fetch(`/kaue/graficopacotes/${maquinaSelecionada}`, {
        method: 'GET',
        headers: { 'Content-Type': 'application/json' },
    }),
    fetch(`/kaue/graficoperda/${maquinaSelecionada}`, {
        method: 'GET',
        headers: { 'Content-Type': 'application/json' },
    })
])
    .then((responses) => {
        // Verifica se ambas as requisições foram bem-sucedidas
        responses.forEach((res, index) => {
            if (!res.ok) {
                throw new Error(`Erro na requisição ${index + 1}: ${res.status}`);
            }
        });
        // Converte ambas as respostas para JSON
        return Promise.all(responses.map((res) => res.json()));
    })
    .then((dados) => {
        const dadosPacotes = dados[0]; // Resultado do primeiro fetch (graficopacotes)
        const dadosPerda = dados[1]; // Resultado do segundo fetch (graficoperda)

        console.log('Dados de pacotes:', dadosPacotes);
        console.log('Dados de perda:', dadosPerda);

        // Atualize a interface com os dois conjuntos de dados aqui
    })
    .catch((err) => {
        console.error('Erro ao buscar dados:', err);
    });
  }
  




  




</script>